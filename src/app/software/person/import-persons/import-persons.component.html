<form class="form-dialog">
    <div class="form-dialog-top-bar" cdkDrag cdkDragRootElement=".cdk-overlay-pane" cdkDragHandle>
        <h3>فراخوانی طرف حساب از اکسل</h3>
        <key-button content="icon" (click)="closeDialog()">
            <mat-icon class="icon-base">close</mat-icon>
        </key-button>
    </div>
    
    <div class="form-dialog-content">
        <div class="form-dialog-content-loading" *ngIf="readExcelLoading || addPersonsLoading">
            <mat-spinner [diameter]="35"></mat-spinner>
        </div>
        <div class="excel-import-actions">
            <a *ngIf="!excelReaded" class="form-dialog-link" href="https://cdn.keyacc.ir/documents/%D8%A7%DA%A9%D8%B3%D9%84%20%D9%86%D9%85%D9%88%D9%86%D9%87%20%D8%B7%D8%B1%D9%81%20%D8%AD%D8%B3%D8%A7%D8%A8.xlsx" download>
                <key-button>
                    <mat-icon class="material-icons-outlined excel-sample-icon">file_open</mat-icon>
                    دانلود نمونه اکسل
                </key-button>
            </a>
            <key-button appearance="error" *ngIf="excelReaded" (click)="onRemoveReadedExcel()">حذف پیوست</key-button>
        </div>

        <p *ngIf="excelReaded" class="excel-import-text">ردیف های نامعتبر با رنگ قرمز مشخص شده و در فراخوانی خوانده نمیشوند همچنین در صورتی که کد طرف حساب تکراری باشد هم ثبت نمیشود</p>
        <div class="content-table flat-table" *ngIf="excelReaded">
            <table mat-table [dataSource]="personsList" keyTiledTable [tiledTable]="tailedTable">
                <ng-container matColumnDef="کد طرف حساب">
                    <th mat-header-cell *matHeaderCellDef> کد طرف حساب </th>
                    <td mat-cell *matCellDef="let element"> 
                        <span [class.invalid-person-type]="!isPersonCodeUniqueInExcel(element.code)">
                            {{ element.code | farsiNumber }} 
                            <ng-container *ngIf="!isPersonCodeUniqueInExcel(element.code)">(تکراری)</ng-container>
                        </span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="نوع">
                    <th mat-header-cell *matHeaderCellDef> نوع </th>
                    <td mat-cell *matCellDef="let element"> 
                        <span [class.invalid-person-type]="!isPersonTypeValid(element.personType)">
                            {{ personTypeTextByNumber(element.personType) }} 
                        </span>
                    </td>
                </ng-container>
                
                <ng-container matColumnDef="نام">
                    <th mat-header-cell *matHeaderCellDef> نام </th>
                    <td mat-cell *matCellDef="let element"> {{ element.personName }} </td>
                </ng-container>
    
                <ng-container matColumnDef="کد ملی یا شماره اقتصادی">
                    <th mat-header-cell *matHeaderCellDef> کد ملی یا شماره اقتصادی </th>
                    <td mat-cell *matCellDef="let element">
                        <span *ngIf="isPersonTypeValid(element.personType)" [class.invalid-person-type]="!isNationalIdOrEconomicCodeValid(element.personType === PersonTypeEnum.Genuine || element.personType === PersonTypeEnum.NonIranianNotionals ? element.nationalId : element.economicCode)">
                            <ng-container *ngIf="element.personType === PersonTypeEnum.Genuine || element.personType === PersonTypeEnum.NonIranianNotionals">{{ element.nationalId | farsiNumber }}</ng-container>
                            <ng-container *ngIf="element.personType !== PersonTypeEnum.Genuine && element.personType !== PersonTypeEnum.NonIranianNotionals">{{ element.economicCode | farsiNumber }}</ng-container>
                        </span>
                        <span class="invalid-person-type" *ngIf="!isPersonTypeValid(element.personType)">
                            نوع طرف حساب نامشخص
                        </span>
                    </td>
                </ng-container>
    
                <ng-container matColumnDef="تلفن">
                    <th mat-header-cell *matHeaderCellDef> تلفن </th>
                    <td mat-cell *matCellDef="let element">
                        <span [class.invalid-person-type]="!isMobileValid(element.mobile)">
                            <ng-container *ngIf="element.tel && element.tel !== 'null'"> {{ element.mobile | farsiNumber }} </ng-container>
                            <ng-container *ngIf="!element.tel || element.tel === 'null'"> بدون تلفن </ng-container>
                        </span>
                    </td>
                </ng-container>
    
                <ng-container matColumnDef="تلفن ثابت">
                    <th mat-header-cell *matHeaderCellDef> تلفن ثابت </th>
                    <td mat-cell *matCellDef="let element">
                        <ng-container *ngIf="element.tel && element.tel !== 'null'"> {{ element.tel | farsiNumber }} </ng-container>
                        <ng-container *ngIf="!element.tel || element.tel === 'null'"> بدون تلفن ثابت </ng-container>
                    </td>
                </ng-container>
    
                <ng-container matColumnDef="کد پستی">
                    <th mat-header-cell *matHeaderCellDef> کد پستی </th>
                    <td mat-cell *matCellDef="let element">
                        <span [class.invalid-person-type]="!isZipCodeValid(element.zipCode)">
                            <ng-container *ngIf="element.zipCode && element.zipCode !== 'null'"> {{ element.zipCode | farsiNumber }}
                            </ng-container>
                            <ng-container *ngIf="!element.zipCode || element.zipCode === 'null'"> بدون کد پستی </ng-container>
                        </span>
                    </td>
                </ng-container>
    
                <ng-container matColumnDef="آدرس">
                    <th mat-header-cell *matHeaderCellDef> آدرس </th>
                    <td mat-cell *matCellDef="let element">
                        <ng-container *ngIf="element.address && element.address !== 'null'"> {{ element.address }}
                        </ng-container>
                        <ng-container *ngIf="!element.address || element.address === 'null'"> بدون آدرس </ng-container>
                    </td>
                </ng-container>
    
                <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: tableColumns;"></tr>
                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell table-no-data" [colSpan]="tableColumns.length">
                        هیچ داده ای یافت نشد
                    </td>
                </tr>
            </table>
        </div>
        <key-upload-area *ngIf="!excelReaded" height="300px" (fileUploaded)="onExcelUploaded($event)"></key-upload-area>
    </div>
    
    <mat-dialog-actions class="form-dialog-footer">
        <key-button appearance="stroked" (click)="closeDialog()">لغو</key-button>
        <key-button [disabled]="personsList.length <= 0" [loading]="importPersonsLoading || addPersonsLoading" (click)="onImportPersons()" type="submit">اضافه کردن</key-button>
    </mat-dialog-actions>
</form>